var currScript,jQEngager,peer_avatar,peer_name,comm_controller,roomId,agentId,iframeId,offlineEmail,offlinePage,offlineNotify,currVersion=15,isOnline=!1,popupInstance=null,openTab=!1;if(currScript=document.currentScript||function(){var a=document.getElementById("newdev-embed-script");return a}(),null==currScript||currScript==null){var scripts=document.getElementsByTagName("script"),index=scripts.length-1;currScript=scripts[index]}var lsRepUrl=currScript.getAttribute("data-source_path"),initVideoNewDev=function(){var a=currScript.getAttribute("data-button-css")?currScript.getAttribute("data-button-css"):"button.css",b=currScript.getAttribute("data-message")?currScript.getAttribute("data-message"):"Start Video Chat";if(peer_avatar=currScript.getAttribute("data-avatar")?currScript.getAttribute("data-avatar"):"",peer_name=currScript.getAttribute("data-names")?currScript.getAttribute("data-names"):"",roomId=currScript.getAttribute("data-room_id")?currScript.getAttribute("data-room_id"):"",agentId=currScript.getAttribute("data-agent_id")?currScript.getAttribute("data-agent_id"):"",iframeId=currScript.getAttribute("data-iframe_id")?currScript.getAttribute("data-iframe_id"):"",offlineEmail=currScript.getAttribute("data-offline_email")?currScript.getAttribute("data-offline_email"):"",offlinePage=currScript.getAttribute("data-offline_page")?currScript.getAttribute("data-offline_page"):"",offlineNotify=currScript.getAttribute("data-offline_message")?currScript.getAttribute("data-offline_message"):"",openTab=!!currScript.getAttribute("data-intab")&&currScript.getAttribute("data-intab"),roomId){var c=new Date,d=c.getTime();c.setTime(d+3600000),document.cookie="visitorId="+roomId+";expires="+c.toGMTString()+";path=/"}var e=function(){if(popupInstance&&!popupInstance.closed)popupInstance.focus();else{var a=445,b=screen.width/2-175,c=screen.height/2-a/2,d={};peer_avatar&&(d.avatar=peer_avatar),peer_name&&(d.names=peer_name),lsRepUrl&&(d.lsRepUrl=lsRepUrl),agentId&&(d.agentId=agentId);var e=window.btoa(JSON.stringify(d));if(openTab)var g="";else g="width=350, height="+a+", left="+b+", top="+c+", location=no, menubar=no, resizable=yes, scrollbars=no, status=no, titlebar=no, toolbar = no";var h=lsRepUrl+"pages/"+roomLinkPage+"?room="+comm_controller.getRoomId()+"&p="+e;if(iframeId)jQEngager("#"+iframeId).attr("src",h);else{popupInstance=window.open("","popup_instance",g);try{"about:blank"===popupInstance.location.href&&(console.log(h),popupInstance.location.href=h)}catch(a){}popupInstance.focus()}window.addEventListener?window.addEventListener("message",f,!1):window.attachEvent("onmessage",f)}},f=function(a){a.data&&"popupClosed"===a.data.type&&comm_controller.popupClosed(comm_controller.getRoomId())},g=function(){jQEngager.ajax({url:lsRepUrl+"config/config.ini?v="+currVersion,type:"GET",dataType:"json",beforeSend:function(a){a&&a.overrideMimeType&&a.overrideMimeType("application/j-son;charset=UTF-8")},success:function(a){svConfigs=a,i()}})},h=function(){loadScript(lsRepUrl+"js/bundle.js",j)},i=function(){loadScript(svConfigs.appWss+"socket.io/socket.io.js",h)},j=function(){comm_controller=new comController,comm_controller.init("visitor","dashboard");var b=jQEngager("<link>",{rel:"stylesheet",type:"text/css",href:lsRepUrl+"css/"+a+"?v="+currVersion});b.appendTo("head"),$container=jQEngager("#nd-widget-container"),l($container)},k=function(){isOnline?jQEngager("#widget_but_span").attr("class","online-bnt"):jQEngager("#widget_but_span").attr("class","offline-bnt")},l=function(a){jQEngager.get(lsRepUrl+"pages/button.html",function(c){a.append(c),console.log("loadButton"),jQEngager(document).on("AdminOnline",function(){isOnline=!0,k()}),jQEngager(document).on("AdminOffline",function(){isOnline=!1,k()}),jQEngager("#newdev_widget_msg").html(b),jQEngager("#widget-but").on("click",function(){isOnline?e():offlineEmail?(jQEngager("#widget_tooltip_container").show(),jQEngager("#widget_tooltip_container").on("click",function(a){jQEngager("#widget_tooltip_container").hide(),a.stopPropagation()}),jQEngager("#offline_message").on("click",function(a){a.stopPropagation()}),jQEngager("#sendEmail").on("click",function(){jQEngager("#widget_tooltip_container").hide();var a=jQEngager("#offline_message").val();document.location.href="mailto:"+offlineEmail+"?subject=Offline request&body="+a})):offlinePage&&(-1===offlinePage.indexOf("http")&&(offlinePage="http://"+offlinePage),window.open(offlinePage))})})};g()};function loadScript(a,b){var c=document.createElement("script");c.type="text/javascript",c.readyState?c.onreadystatechange=function(){("loaded"==c.readyState||"complete"==c.readyState)&&(c.onreadystatechange=null,b&&b())}:c.onload=function(){b&&b()},c.src=a+"?v="+currVersion,document.getElementsByTagName("head")[0].appendChild(c)}var ms=Date.now();"undefined"==typeof jQuery||11>parseInt(jQuery.fn.jquery.split(".")[1])?loadScript("https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js",function(){jQEngager=jQuery.noConflict(!0),jQEngager.get(lsRepUrl+"pages/version.txt?v="+ms,function(a){currVersion=a,jQEngager(document).ready(new initVideoNewDev)})}):(jQEngager=jQuery,jQEngager.get(lsRepUrl+"pages/version.txt?v="+ms,function(a){currVersion=a,jQEngager(document).ready(new initVideoNewDev)}));